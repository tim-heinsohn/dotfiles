#!/bin/bash
set -euo pipefail

DOTFILES_DIR=${DOTFILES_DIR:-~/dotfiles}
echo "Integrating Mail Server MCP (primary and secondary)..."

if [ -f "$HOME/.mail-server-mcp/wrapper-primary" ] && [ -f "$HOME/.mail-server-mcp/wrapper-secondary" ]; then
  echo "Adding mail-primary to Claude Code..."
  primary_config="{\"command\":\"$HOME/.mail-server-mcp/wrapper-primary\"}"
  claude mcp add-json mail-primary "$primary_config" --scope user
  echo "âœ“ mail-primary integrated"
  "$DOTFILES_DIR/bin/codex-mcp" upsert mail-primary <<EOF
[mcp.servers.mail-primary]
# Goose integration (primary/secondary)
"$DOTFILES_DIR/goose/integrate" upsert-stdio mail-primary "$HOME/.mail-server-mcp/wrapper-primary"
"$DOTFILES_DIR/goose/integrate" upsert-stdio mail-secondary "$HOME/.mail-server-mcp/wrapper-secondary"
