#!/bin/bash

# n8n MCP Server Installation Script
# Based on czlonkowski/n8n-mcp - Most comprehensive n8n MCP implementation

set -euo pipefail

N8N_MCP_DIR="$HOME/.n8n-mcp"
N8N_MCP_REPO="https://github.com/czlonkowski/n8n-mcp.git"

echo "Installing n8n MCP Server..."

# Create directory if it doesn't exist
mkdir -p "$N8N_MCP_DIR"

# Clone or update the repository
if [ -d "$N8N_MCP_DIR/.git" ]; then
    echo "Updating existing n8n MCP Server..."
    cd "$N8N_MCP_DIR"
    git pull
else
    echo "Cloning n8n MCP Server..."
    git clone "$N8N_MCP_REPO" "$N8N_MCP_DIR"
    cd "$N8N_MCP_DIR"
fi

# Install dependencies
echo "Installing dependencies..."
npm install

# Build the server
echo "Building n8n MCP Server..."
npm run build

# Initialize database with n8n node documentation
echo "Initializing n8n node database..."
npm run rebuild

echo "n8n MCP Server installed successfully!"
echo ""
echo "Features available:"
echo "• 535+ n8n nodes from n8n-nodes-base and @n8n/n8n-nodes-langchain"
echo "• 99% coverage of node properties with detailed schemas"  
echo "• 63.6% coverage of node operations"
echo "• 90% documentation coverage from official n8n docs"
echo "• 263 AI-capable nodes with full documentation"
echo ""
echo "Next steps:"
echo "1. Add n8n MCP to Claude Code configuration"
echo "2. Use the MCP to get help building n8n workflows"
echo ""
echo "See: ~/dotfiles/n8n-mcp/doc/usage.md for detailed usage instructions"