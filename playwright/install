#!/bin/bash
#
# This script documents the reproducible process for installing Playwright MCP
# (Model Context Protocol) on Arch Linux for use with Claude Code.

# --- Installation Process ---

# 1. Install System-Level Dependencies
# These are required for the Playwright browsers to run correctly.
# You will be prompted for your password.
echo "Step 1: Installing system dependencies..."
sudo pacman -S --needed --noconfirm nss nspr at-spi2-core libcups libdrm dbus libxcb libxkbcommon libx11 libxcomposite libxdamage libxext libxfixes libxrandr mesa pango cairo alsa-lib xorg-server-xvfb woff2 hyphen
yay -S --needed --noconfirm icu66 enchant libffi7 libwebp


# 2. Install Playwright MCP (Model Context Protocol)
# This is a server that uses Playwright to provide browser automation
# capabilities to Claude Code and other AI assistants.
echo "Step 2: Installing Playwright MCP..."
npm install -g @playwright/mcp


# 3. Install Browser Dependencies
# This pulls the required browser binaries (Chromium, Firefox, WebKit)
echo "Step 3: Installing browser dependencies..."
npx playwright install chromium
npx playwright install firefox
npx playwright install webkit

# 3b. Install Google Chrome (optional, for Chrome-specific testing)
# echo "Installing Google Chrome..."
# yay -S --needed --noconfirm google-chrome


# 4. Configure Claude Code
# Add the MCP server to Claude Code for browser automation
echo "Step 4: Configuring Claude Code..."
claude mcp list | grep -q playwright || claude mcp add --scope=user playwright npx '@playwright/mcp@latest' || echo "Claude not found - run manually: claude mcp add playwright npx '@playwright/mcp@latest'"


# 5. Verify the installation
echo "Step 5: Verifying installation..."
echo "1. Test MCP server: mcp-server-playwright"
echo "2. Check global installation: npm ls -g @playwright/mcp"
echo "3. Test in Claude: 'Use playwright to open https://google.com'"


echo "Playwright MCP installation is complete!"
