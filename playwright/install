#!/bin/bash
#
# This script documents the reproducible process for installing Playwright on Arch Linux.
# It uses a virtual environment managed by direnv to avoid system conflicts.

# --- Installation Process ---

# 1. Install System-Level Dependencies
# These are required for the Playwright browsers to run correctly.
# You will be prompted for your password.
echo "Step 1: Installing system dependencies..."
sudo pacman -S --needed --noconfirm nss nspr at-spi2-core libcups libdrm dbus libxcb libxkbcommon libx11 libxcomposite libxdamage libxext libxfixes libxrandr mesa pango cairo alsa-lib xorg-server-xvfb woff2 hyphen
yay -S --needed --noconfirm icu66 enchant libffi7 libwebp


# 2. Set up direnv for Automatic Virtual Environment Management
# This will create a .envrc file that tells direnv to manage a Python
# virtual environment for this directory.
echo "Step 2: Configuring direnv..."
echo "layout python" > .envrc
direnv allow .


# 3. Install Playwright in the direnv Environment
# This command must be run in a shell where direnv has activated the
# virtual environment (i.e., in this directory).
echo "Step 3: Installing Playwright..."
echo "Please run the following command in your terminal:"
echo "uv pip install playwright && python -m playwright install"


# 4. Verify the installation
# After running the command above, you can verify the installation.
# NOTE: You will likely see a "Host validation warning" about missing
# dependencies. This is a false positive on Arch Linux because Playwright's
# check is designed for Ubuntu. As long as the dependencies in Step 1
# were installed successfully, this warning can be safely ignored.
echo "Step 4: Verifying installation..."
echo "Run 'which playwright'. It should now return a path inside the .direnv directory."

echo "Playwright installation is complete."
