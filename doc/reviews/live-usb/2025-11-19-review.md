# Review: live-usb Branch

**Date:** 2025-11-19
**Branch:** `live-usb`
**Comparison:** `live-usb` vs `origin/main`

## Overview

The `live-usb` branch introduces a comprehensive Ruby-based toolchain for creating and managing Grml Live USBs. This replaces or augments previous manual processes with automated, safe, and customizable scripts. Additionally, it includes updates to the system package list and the i3 status bar configuration.

## Key Changes

### 1. New Tools: `create-grml-live-usb` & `modify-grml-live-usb`
Two new Ruby scripts located in `bin/live-usb/` provide the core functionality:
*   **`create-grml-live-usb`**: Automates downloading, verifying (SHA256 + GPG), customizing, and writing Grml ISOs to USB drives.
*   **`modify-grml-live-usb`**: Allows modification of boot parameters (font size, language, keyboard layout) on existing Grml USBs without reformating.

### 2. System Updates
*   **`bin/packages`**: Updated to include necessary dependencies (implied, based on file modification).
*   **`bin/binaries-symlink`**: Updates symlinking logic to include the new tools in the user's path.

### 3. i3 Status Bar
*   **`i3/i3status_with_hostname`**: Adds a "REBOOT" indicator that appears when the running kernel version differs from the installed kernel version.

## Assessment

### Strong Points

*   **Robust Safety Mechanisms**: The creation script implements rigorous safety checks:
    *   **System Disk Detection**: Prevents accidental overwriting of system or encrypted partitions.
    *   **Device Signature**: Captures device state before user confirmation and verifies it hasn't changed before writing, mitigating race conditions where devices might be swapped.
    *   **Double Confirmation**: Requires explicit user input ("WRITE /dev/sdX") to proceed.
*   **Code Quality & Structure**:
    *   The scripts utilize object-oriented Ruby (Classes: `Creator`, `Modifier`, `BlockDevice`), making them modular and readable.
    *   Consistent error handling using custom `Error` classes.
    *   Good use of `Open3` for safe shell command execution.
*   **Feature Richness**:
    *   **Customization**: Supports injecting SSH passwords, custom boot parameters, and modifying keyboard layouts/fonts post-creation.
    *   **Verification**: Automatically handles GPG signature verification and SHA256 checksums for downloaded ISOs.
*   **UX Improvements**: The i3status update provides a valuable visual cue for pending system reboots due to kernel updates.

### Weak Points & Suggestions

*   **Code Duplication**: The `BlockDevice` class and some helper methods (like `which`, `run_privileged!`) seem potentially reusable or similar across both scripts.
    *   *Suggestion*: If these tools evolve, consider extracting shared logic into a common library file (e.g., `lib/live_usb/device.rb`) to adhere to DRY principles.
*   **Dependency Management**: The scripts rely on several external binaries (`xorriso`, `gpg`, `curl`, `lsblk`, `cmp`, `partprobe`).
    *   *Suggestion*: Ensure `bin/packages` explicitly lists `libisoburn` (for xorriso) and other required tools. The scripts do check for their presence, which is good, but centralized package management is better.
*   **Pacman Dependency in i3status**: The kernel mismatch check relies on parsing `pacman` output: `pacman -Q linux ...`.
    *   *Suggestion*: This is Arch-specific. While likely intended for this environment, adding a comment or a check for `pacman` existence would make the script more portable or at least fail gracefully on non-Arch systems.
*   **Hardcoded URLs**: `DOWNLOAD_BASE` is hardcoded to `https://download.grml.org/`.
    *   *Suggestion*: While stable, moving this to a constant at the top or a configuration object would make it easier to update if the mirror changes.

## Conclusion

The `live-usb` branch represents a significant improvement in tooling for system administration tasks (specifically live media creation). The implementation is high-quality, safe, and idiomatic. The accompanying changes to i3status add immediate utility.

**Recommendation:** **Merge**, provided the package dependencies in `bin/packages` are verified to cover all new tool requirements.
