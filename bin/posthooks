#!/bin/bash
#
# posthooks: Run post-installation setup tasks
#
# Description:
# Sets up additional symlinks and configurations that cannot be
# handled by Bombadil (e.g., files with template syntax conflicts).
#
# This runs after bombadil creates symlinks.

set -euo pipefail

# Setup projects and symlinks
~/dotfiles/bin/projects-setup
~/dotfiles/bin/binaries-symlink

# Setup gopass cascading config
~/dotfiles/bin/gopass-config-include

# Setup p10k.zsh symlink (bypassing bombadil validation)
ln -sf ~/dotfiles/zsh/p10k.zsh ~/.p10k.zsh
# Setup p10k.claude.zsh symlink (bypassing bombadil validation due to Tera parsing ${#...})
mkdir -p ~/.zsh
ln -sf ~/dotfiles/zsh/p10k.claude.zsh ~/.zsh/p10k.claude.zsh

# Symlink MCP CLI from ~/mcp if present
if [ -x "$HOME/mcp/bin/mcp" ]; then
  mkdir -p "$HOME/bin"
  ln -sf "$HOME/mcp/bin/mcp" "$HOME/bin/mcp"
  echo "Linked ~/bin/mcp -> ~/mcp/bin/mcp"
fi

# Print reminder for brightness control
echo "Run ~/dotfiles/services/acpi/enable to enable brightness control."
