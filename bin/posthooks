#!/bin/bash
# @description Post-link hooks - runs after bombadil link for additional setup

print_help() {
    cat <<'EOF'
Usage: posthooks

Runs after bombadil link to complete setup:
- Runs projects-setup for project directories
- Sets up binaries-symlink
- Configures gopass cascading config
- Creates p10k.zsh and p10k.claude.zsh symlinks
- Links MCP CLI if present
- Prints reminders for additional setup

This script is called automatically by bombadil.
EOF
}

case "$1" in
    -h|--help)
        print_help
        exit 0
        ;;
esac

# Setup projects and symlinks
~/dotfiles/bin/projects-setup
~/dotfiles/bin/binaries-symlink

# Setup gopass cascading config
~/dotfiles/bin/gopass-config-include

# Setup p10k.zsh symlink (bypassing bombadil validation)
ln -sf ~/dotfiles/zsh/p10k.zsh ~/.p10k.zsh
# Setup p10k.claude.zsh symlink (bypassing bombadil validation due to Tera parsing ${#...})
mkdir -p ~/.zsh
ln -sf ~/dotfiles/zsh/p10k.claude.zsh ~/.zsh/p10k.claude.zsh

# Symlink MCP CLI from ~/mcp if present
if [ -x "$HOME/mcp/bin/mcp" ]; then
  mkdir -p "$HOME/bin"
  ln -sf "$HOME/mcp/bin/mcp" "$HOME/bin/mcp"
  echo "Linked ~/bin/mcp -> ~/mcp/bin/mcp"
fi

# Print reminder for brightness control
echo "Run ~/dotfiles/acpi/enable to enable brightness control."
