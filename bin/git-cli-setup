#!/bin/bash

# Git Service CLI Setup Checker
# Checks login status for GitHub CLI (gh), GitLab CLI (glab), and Atlassian CLI (acli)

echo "üîç Checking Git service CLI authentication status..."
echo

# GitHub CLI
echo "üìä GitHub CLI (gh):"
if command -v gh &> /dev/null; then
    if gh auth status &> /dev/null; then
        echo "‚úÖ Already logged in"
    else
        echo "‚ùå Not logged in"
        echo "üîë API Token: Create at https://github.com/settings/tokens"
        echo "üöÄ Run: gh auth login"
        read -p "Login now? [y/N]: " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            gh auth login
        fi
    fi
else
    echo "‚ö†Ô∏è  GitHub CLI not installed"
fi
echo

# GitLab CLI
echo "üìä GitLab CLI (glab):"
if command -v glab &> /dev/null; then
    if glab auth status &> /dev/null; then
        echo "‚úÖ Already logged in"
    else
        echo "‚ùå Not logged in"
        echo "üîë API Token: Create at https://gitlab.com/-/profile/personal_access_tokens"
        echo "üöÄ Run: glab auth login"
        read -p "Login now? [y/N]: " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            glab auth login
        fi
    fi
else
    echo "‚ö†Ô∏è  GitLab CLI not installed"
fi
echo

# Atlassian CLI
echo "üìä Atlassian CLI (acli):"
if command -v acli &> /dev/null; then
    # Check if already logged in
    if acli jira auth status &> /dev/null; then
        echo "‚úÖ Already logged in to Jira"
    else
        echo "‚ùå Not logged in"
        echo "üîë API Token: Create at https://id.atlassian.com/manage-profile/security/api-tokens"
        echo "üöÄ Run: acli jira auth login --site YOUR_INSTANCE --email YOUR_EMAIL --token"
        echo "   Example: echo \$(gopass show -o api-token-name) | acli jira auth login --site example.atlassian.net --email user@example.com --token"
        echo "   Or use browser login: acli jira auth login --web"
    fi
else
    echo "‚ö†Ô∏è  Atlassian CLI not installed"
fi

echo
echo "üìñ For Claude Code usage:"
echo "- Use 'gh' for GitHub repositories, PRs, and issues"
echo "- Use 'glab' for GitLab repositories, MRs, and issues"
echo "- Use 'acli' for Bitbucket repositories, PRs, and Jira issues"